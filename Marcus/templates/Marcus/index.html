<html>
  <head>
    <title>Remote Cameras</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/cupertino/jquery-ui.css" />
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/JavaScript">
    $(document).ready(function() {
        $("#add_camera_link").click(function() {
          $("#add_camera").toggle();
        });
        $("#remove_camera_link").click(function(){
          $("#remove_camera").toggle();
        });

        {% if camera_list %}
          {% for each_camera in camera_list %}
            $("#timeslider_{{ each_camera.uuid }}").slider()
            $("#timeslider_{{ each_camera.uuid }}").change(
              function() {
                var new_value = $(this).val();
                var data_dump = JSON.stringify({"action":"get_frame_info",
                                                "camera_uuid":"{{ each_camera.uuid }}",
                                              "offset":new_value});
                $.post("json-api/",data_dump,function(data,textStatus,jqXHR){
                  response_data = JSON.parse(data);
                  if (response_data['success'] == true) {
                    $("#camera_frame_{{ each_camera.id }}").attr('src',"http://6846cedarcove.webcam/uploaded_images/" + response_data['frame_url']);
                    $("#timestamp_{{ each_camera.uuid }}").text(response_data['frame_timestamp']);
                  }
                  else {
                    alert("Error updating camera(s)!");
                  }
                });
            });
          {% endfor %}
        {% endif %}


        var data_dump = JSON.stringify({"action":"getCameraData"});
	      $.post("json-api/",data_dump,function(data,textStatus,jqXHR){
          response_data = JSON.parse(data);
          if (response_data['success'] == true) {
            var camera_data = response_data["cameras"]
            for( each in camera_data ) {
              var timeslider_id = "#timeslider_" + each;
              var widget = $(timeslider_id);
              widget.slider("option","min",0);
              widget.slider("option","max",camera_data[each]["frames"]-1);
              widget.slider("value",camera_data[each]["frames"]-1);
              $(timeslider_id + " span").css("left","100%");
              $("#timestamp_" + each).text(camera_data[each]['latest_frame_timestamp']);
            }
          }
          else {
            alert("Error updating camera(s)!");
          }
        });
    });
    </script>
    <style type="text/css">

      #add_camera { display: none; width:340px; padding: 5px; }
      #add_camera_name { padding: 3px; }
      #add_camera_uuid { padding: 3px; }
      #new_camera_button { padding: 3px; }
      #remove_camera { display: none; }
      li {list-style-type: none;}
      .camera_timeslider {width: 480px;
      margin: 30px;}
      .camera_uuid_display {
        margin-top:30px;
      }
      .camera_still {width: 640;
                    height: 480;
                    background-color: #cdcdcdcd;
                    -ms-transform: rotate(180deg); /* IE 9 */
                    -webkit-transform: rotate(180deg); /* Chrome, Safari, Opera */
                    transform: rotate(180deg);}
    </style>
  </head>
  <body>
  {% if camera_list %}
    <ul>
    {% for each_camera in camera_list %}
      <li><h2>{{ each_camera.name }}</h2>
      <div class="camera_timeslider" id="timeslider_{{ each_camera.uuid }}"></div><div class="timestamp" id="timestamp_{{ each_camera.uuid }}"></div>
      <div class="camera_still"><img id="camera_frame_{{ each_camera.id }}" width="640" height="480" src="/camera/{{ each_camera.id }}/latest_still.jpg" /></div>
      <div class="camera_uuid_display"><strong>UUID</strong>&nbsp;{{ each_camera.uuid }}</div>
      <div><strong>IP Address</strong>&nbsp;{{ each_camera.ip_addr }}</div>
    </li>
    {% endfor %}
    </ul>
  {% else %}
    <h1>No cameras available.</h1>
  {% endif %}
  <ul>
    <li>
      <a id="add_camera_link" href="#">Add Camera</a>
      <form id="add_camera" method="post">
        <div id="add_camera_name"><input name="new_camera_name" size="55" placeholder="Camera Description" /></div>
        <div id="add_camera_uuid"><input name="new_camera_uuid" size="55" placeholder="Camera UUID" /></div>
        <div id="new_camera_button" align="right"><input type="submit" id="new_camera_btn" /></div>
      </form>
    </li>
    <li>
      <a id="remove_camera_link" href="#">Remove Camera</a>
      <form id="remove_camera" method="post">
        {% if camera_list %}
          <select name="remove_camera_id">
          {% for each_camera in camera_list %}
            <option value="{{ each_camera.id }}">{{ each_camera.name }}</option>
          {% endfor %}
        </select>
        <input type="submit" size="55" id="remove_camera_btn" />
        {% else %}
          <p>No cameras available.</p>
        {% endif %}
      </form>
    </li>
  </ul>
  </body>
</html>
